# Developer PEG — Internal Implementation
# Component: engine-llm
# Namespace: EngineLlm
# Type: engine
# Generated by refection — do not edit
#
# This grammar describes the internal structure of the component:
# models, controllers, routes, migrations, and their relationships.

# ─── Component Structure ────────────────────────────────────────

EngineLlm  <- Models Controllers Routes Schema Dependencies

# ─── Models ─────────────────────────────────────────────────────

Models          <- Model_Conversation / Model_HeartBeat / Model_HeartBeatExecution / Model_Preference / Model_Provider / Model_ProviderModel / Model_Setting

Model_Conversation  <- 'Conversation' '<' 'ApplicationRecord'
                    Table: 'cl_conversations'
                    Validates_title

Model_HeartBeat  <- 'HeartBeat' '<' 'ApplicationRecord'
                    Table: 'cl_heartbeats'

Model_HeartBeatExecution  <- 'HeartBeatExecution' '<' 'ApplicationRecord'
                    Table: 'cl_heartbeat_executions'

Model_Preference  <- 'Preference' '<' 'ApplicationRecord'
                    Table: 'cl_preferences'
                    belongs_to_default_model belongs_to_preferred_provider

Model_Provider  <- 'Provider' '<' 'ApplicationRecord'
                    Table: 'cl_providers'
                    has_many_provider_models
                    Scope_ordered Scope_active

Model_ProviderModel  <- 'ProviderModel' '<' 'ApplicationRecord'
                    Table: 'cl_provider_models'
                    belongs_to_provider
                    Scope_ordered Scope_active Scope_free_tier

Model_Setting  <- 'Setting' '<' 'ApplicationRecord'
                    Table: 'cl_settings'
                    Validates_key

# ─── Associations ───────────────────────────────────────────────

belongs_to_default_model  <- 'belongs_to' ':' 'default_model' ',' 'class_name: "EngineLlm::ProviderModel", optional: true'

belongs_to_preferred_provider  <- 'belongs_to' ':' 'preferred_provider' ',' 'class_name: "EngineLlm::Provider",      optional: true'

has_many_provider_models  <- 'has_many' ':' 'provider_models' ',' 'dependent: :destroy'

belongs_to_provider  <- 'belongs_to' ':' 'provider'

# ─── Validations ────────────────────────────────────────────────

Validates_title  <- 'validates' 'title' 'presence: true'

Validates_key  <- 'validates' 'key' 'presence: true, uniqueness: true'

# ─── Scopes ─────────────────────────────────────────────────────

Scope_ordered  <- 'scope' ':' 'ordered' '->' Block

Scope_active  <- 'scope' ':' 'active' '->' Block

Scope_ordered  <- 'scope' ':' 'ordered' '->' Block

Scope_active  <- 'scope' ':' 'active' '->' Block

Scope_free_tier  <- 'scope' ':' 'free_tier' '->' Block

# ─── Controllers ────────────────────────────────────────────────

Controllers     <- Controller_ConversationsController / Controller_MessagesController / Controller_PreferencesController / Controller_SettingsController

Controller_ConversationsController  <- 'ConversationsController' '<' 'ApplicationController'
                    BeforeAction_find_conversation
                    Action_index Action_show Action_create Action_destroy Action_find_conversation

Controller_MessagesController  <- 'MessagesController' '<' 'ApplicationController'
                    BeforeAction_find_conversation
                    Action_create Action_find_conversation

Controller_PreferencesController  <- 'PreferencesController' '<' 'ApplicationController'
                    Action_show Action_update

Controller_SettingsController  <- 'SettingsController' '<' 'ApplicationController'
                    Action_show Action_update

# ─── Controller Actions ────────────────────────────────────────

BeforeAction_find_conversation  <- 'before_action' ':' 'find_conversation'

Action_index    <- 'def' 'index'

Action_show    <- 'def' 'show'

Action_create    <- 'def' 'create'

Action_destroy    <- 'def' 'destroy'

Action_find_conversation    <- 'def' 'find_conversation'

BeforeAction_find_conversation  <- 'before_action' ':' 'find_conversation'

Action_create    <- 'def' 'create'

Action_find_conversation    <- 'def' 'find_conversation'

Action_show    <- 'def' 'show'

Action_update    <- 'def' 'update'

Action_show    <- 'def' 'show'

Action_update    <- 'def' 'update'

# ─── Routes ─────────────────────────────────────────────────────

EngineRoutes    <- 'EngineLlm::Engine.routes.draw'

Routes          <- Route_conversations / Route_messages / Route_settings / Route_preferences

Route_conversations  <- 'resource' 'conversations' 'only: %i[index show create destroy]'

Route_messages  <- 'resource' 'messages' 'only: %i[create]'

Route_settings  <- 'resource' 'settings' 'only: %i[show update]'

Route_preferences  <- 'resource' 'preferences' 'only: %i[show update]'

# ─── Schema (from migrations) ──────────────────────────────────

Schema          <- Table_cl_conversations / Table_cl_settings / Table_cl_providers / Table_cl_provider_models / Table_cl_preferences / Table_cl_heartbeats / Table_cl_heartbeat_executions

Table_cl_conversations  <- 'cl_conversations'
                    Col_title Col_transcript Col_model Col_created_at Col_updated_at

Table_cl_settings  <- 'cl_settings'
                    Col_key Col_value Col_created_at Col_updated_at

Table_cl_providers  <- 'cl_providers'
                    Col_name Col_slug Col_env_key Col_api_base_url Col_active Col_position Col_created_at Col_updated_at

Table_cl_provider_models  <- 'cl_provider_models'
                    Col_provider Col_value Col_label Col_position Col_active Col_free Col_created_at Col_updated_at

Table_cl_preferences  <- 'cl_preferences'
                    Col_default_model Col_preferred_provider Col_temperature Col_max_tokens Col_created_at Col_updated_at

Table_cl_heartbeats  <- 'cl_heartbeats'
                    Col_task_name Col_description Col_interval_seconds Col_cron_expression Col_last_run_at Col_next_run_at Col_enabled Col_priority Col_max_retries Col_retry_delay_seconds Col_metadata Col_created_at Col_updated_at

Table_cl_heartbeat_executions  <- 'cl_heartbeat_executions'
                    Col_heartbeat Col_status Col_started_at Col_completed_at Col_duration_ms Col_error_message Col_attempt_number Col_created_at Col_updated_at

# ─── Columns ────────────────────────────────────────────────────

Col_title  <- 'string' ':' 'title'

Col_transcript  <- 'text' ':' 'transcript'

Col_model  <- 'string' ':' 'model'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_key  <- 'string' ':' 'key'

Col_value  <- 'text' ':' 'value'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_name  <- 'string' ':' 'name'

Col_slug  <- 'string' ':' 'slug'

Col_env_key  <- 'string' ':' 'env_key'

Col_api_base_url  <- 'string' ':' 'api_base_url'

Col_active  <- 'boolean' ':' 'active'

Col_position  <- 'integer' ':' 'position'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_provider  <- 'references' ':' 'provider'

Col_value  <- 'string' ':' 'value'

Col_label  <- 'string' ':' 'label'

Col_position  <- 'integer' ':' 'position'

Col_active  <- 'boolean' ':' 'active'

Col_free  <- 'boolean' ':' 'free'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_default_model  <- 'references' ':' 'default_model'

Col_preferred_provider  <- 'references' ':' 'preferred_provider'

Col_temperature  <- 'decimal' ':' 'temperature'

Col_max_tokens  <- 'integer' ':' 'max_tokens'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_task_name  <- 'string' ':' 'task_name'

Col_description  <- 'text' ':' 'description'

Col_interval_seconds  <- 'integer' ':' 'interval_seconds'

Col_cron_expression  <- 'string' ':' 'cron_expression'

Col_last_run_at  <- 'datetime' ':' 'last_run_at'

Col_next_run_at  <- 'datetime' ':' 'next_run_at'

Col_enabled  <- 'boolean' ':' 'enabled'

Col_priority  <- 'integer' ':' 'priority'

Col_max_retries  <- 'integer' ':' 'max_retries'

Col_retry_delay_seconds  <- 'integer' ':' 'retry_delay_seconds'

Col_metadata  <- 'json' ':' 'metadata'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

Col_heartbeat  <- 'references' ':' 'heartbeat'

Col_status  <- 'string' ':' 'status'

Col_started_at  <- 'datetime' ':' 'started_at'

Col_completed_at  <- 'datetime' ':' 'completed_at'

Col_duration_ms  <- 'integer' ':' 'duration_ms'

Col_error_message  <- 'text' ':' 'error_message'

Col_attempt_number  <- 'integer' ':' 'attempt_number'

Col_created_at  <- 'datetime' ':' 'created_at'

Col_updated_at  <- 'datetime' ':' 'updated_at'

# ─── Dependencies ───────────────────────────────────────────────

Dependencies    <- Dep_rails Dep_view_component Dep_raix

Dep_rails  <- 'rails'

Dep_view_component  <- 'view_component'

Dep_raix  <- 'raix'

# ─── Terminals ──────────────────────────────────────────────────

Identifier      <- [a-zA-Z_] [a-zA-Z0-9_]*
Block           <- '{' .* '}'
